å‰é¢æˆ‘ä»¬å·²ç»æ­å»ºå¥½äº†ç½‘ç«™è¿è¡Œç¯å¢ƒï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æ–°å»ºæˆ‘ä»¬çš„ç½‘ç«™å•¦ã€‚

### åŸŸåè§£æ

è¿™é‡Œä»¥é˜¿é‡Œäº‘çš„DNSæ§åˆ¶é¢æ¿æ¥åšä¸ªç¤ºèŒƒï¼Œæ¥åˆ°è§£ææ§åˆ¶å°ï¼Œç‚¹å‡»æŒ‰é’®å¢åŠ è§£æã€‚

![æ–°å¢è§£æ](https://cdn.exia.xyz/img/imouto/course7/3.png)

![å…·ä½“å‚æ•°](https://cdn.exia.xyz/img/imouto/course7/4.png)

è¿™é‡Œçš„å„é¡¹éƒ½ç»™ä¸ªè§£é‡Šå§ã€‚

> **è®°å½•ç±»å‹**
>
> å¸¸è§çš„æœ‰ä¸¤ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯`A`ï¼Œ`CNAME`ã€‚
>
> `A`è®°å½•æ˜¯ç›´æ¥è§£æåˆ°IPçš„ï¼Œä¸€èˆ¬æˆ‘ä»¬è‡ªå·±ç”¨VPSå»ºç«™çš„æ—¶å€™ä¼šç”¨åˆ°
>
> `CNAME`è®°å½•æ˜¯è§£æåˆ°å¦ä¸€ä¸ªåŸŸåï¼Œä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨è™šæ‹Ÿä¸»æœºæˆ–è€…å…¶ä»–æ‰˜ç®¡æœåŠ¡æ—¶ä¼šé‡åˆ°
>
> **ä¸»æœºè®°å½•**
>
> å°±æ˜¯æŒ‡ä½ çš„åŸŸåå‰ç¼€ï¼Œä¾‹å¦‚æˆ‘è¿™é‡Œå¡«çš„`blog`ï¼Œä»£è¡¨è¯´æˆ‘æ­£åœ¨æŠŠ`blog.hk416.space`è§£æåˆ°ç›®æ ‡åœ°å€ã€‚å¦‚æœæˆ‘æƒ³è§£æ`www.hk416.space`è¦æ€ä¹ˆåŠå‘¢ï¼Ÿå¯¹å•¦ï¼Œä¸»æœºè®°å½•è¿™é‡Œå°±å¡«ä¸Š`www`å°±å¥½äº†ã€‚
>
> P.S å¦‚æœæˆ‘ä»¬æƒ³ç›´æ¥è§£ææ•´ä¸ªæ ¹åŸŸå(`hk416.space`)ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å¡«å†™çš„ä¸»æœºè®°å½•å€¼ä¸º`@`ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º`æ³›è§£æ`
>
> **è§£æè·¯çº¿**
>
> æš‚æ—¶ä¸æˆ‘ä»¬æ²¡ä»€ä¹ˆå…³ç³»
>
> **è®°å½•å€¼**
>
> å°±æ˜¯ä½ è¦è§£æåˆ°çš„åœ°æ–¹å•¦ï¼Œè¿™é‡Œæˆ‘ä»¬å¡«ä¸Šæˆ‘ä»¬çš„æœåŠ¡å™¨IPå³å¯ã€‚

éƒ½å¡«å†™å®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç‚¹å‡»ç¡®è®¤æ¥ä¿å­˜ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥å»æœåŠ¡å™¨é‚£é‡Œæ–°å»ºç½‘ç«™äº†ã€‚



### Oneinstackå‘½ä»¤è¡Œæ“ä½œ

åœ¨æˆ‘ä»¬å®‰è£…å¥½oneinstackä¹‹åï¼Œè¿›å…¥Oneinstackçš„æ–‡ä»¶å¤¹ï¼Œè¾“å‡ºä¸€ä¸‹æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°

![oneinstackç›®å½•å†…å®¹](https://cdn.exia.xyz/img/imouto/course7/2.png)

> #### çŸ¥è¯†æ‹“å±•
>
> è¿™é‡Œä¸åŒçš„é¢œè‰²é«˜äº®è¡¨ç¤ºä¸åŒçš„æ–‡ä»¶ç±»å‹æˆ–è€…æ–‡ä»¶å¤¹ã€‚ä¸€èˆ¬è¿™äº›ç»¿è‰²çš„ä»¥`.sh`ç»“å°¾çš„ä¸ºå¯æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶ã€‚è“è‰²çš„åˆ™è¡¨ç¤ºæ–‡ä»¶å¤¹ï¼Œè€Œæ²¡æœ‰é«˜äº®çš„æƒ¨ç™½è‰²çš„åˆ™ä¸ºæ™®é€šçš„æ–‡ä»¶ã€‚

æˆ‘ä»¬æ·»åŠ ç½‘ç«™éœ€è¦ç”¨åˆ°çš„å°±æ˜¯å³ä¸‹è§’è¢«æ°´å°æŒ¡ä½çš„`vhost.sh`äº†ã€‚ä½†æ˜¯åœ¨è¿™ä¹‹å‰ï¼Œä¸ºäº†èƒ½è®©æˆ‘ä»¬æ­å»ºç½‘ç«™çš„è¿‡ç¨‹ä¸­èƒ½å¤Ÿé¡ºåˆ©ç”³è¯·åˆ°SSLè¯ä¹¦ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†åŸŸåè§£æè‡³æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚è®°å¾—å“¦ï¼

å›åˆ°XSHELLï¼Œåœ¨**Oneinstackç›®å½•ä¸‹**ï¼Œè¿è¡Œ`vhost.sh`æ¥æ–°å»ºç½‘ç«™

```shell
#è¿›å…¥Oneinstackæ–‡ä»¶å¤¹
cd /path/to/oneinstack
#è¿è¡Œè„šæœ¬
./vhost.sh
```

è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–çš„ä¸€ä¸ªæ¬¢è¿ç•Œé¢ï¼Œç„¶åå°±ä¼šå¼€å§‹ä¸€ç³»åˆ—çš„é€‰æ‹©ï¼Œè¿™é‡Œæˆ‘ä¼šæŠŠæ‰€æœ‰é€‰é¡¹çš„å«ä¹‰ä¸æ³¨æ„äº‹é¡¹æ ‡æ³¨å‡ºæ¥ã€‚

```shell
#######################################################################
#       OneinStack for CentOS/RedHat 6+ Debian 8+ and Ubuntu 14+      #
#       For more information please visit https://oneinstack.com      #
#######################################################################

What Are You Doing? 
	1. Use HTTP Only  #åªä½¿ç”¨httpæ–°å»ºç½‘ç«™
	2. Use your own SSL Certificate and Key #æ–°å»ºç½‘ç«™ï¼Œå¹¶ä½¿ç”¨è‡ªå·±çš„SSLè¯ä¹¦ä¸å¯†é’¥
	3. Use Lets Encrypt to Create SSL Certificate and Key #æ–°å»ºç½‘ç«™ï¼Œé¡ºä¾¿å¸®æˆ‘ä½¿ç”¨Lets Encryptæ¥åˆ›å»ºä¸€ä¸ªå…è´¹çš„è¯ä¹¦
	q. Exit #æ‰“æ‰°äº†
Please input the correct option: 3
#è¿™é‡Œå»ºè®®é€‰æ‹©3é€‰é¡¹ï¼Œé™¤éä½ æœ‰æ›´å¥½çš„SSLè¯ä¹¦é€‰æ‹©

Please input domain(example: www.example.com): blog.hk416.space
#è¯·è¾“å…¥ä½ çš„åŸŸåï¼Œè¿™é‡Œå¡«å†™åˆšåˆšè§£æçš„åŸŸåï¼Œè¦åŠ ä¸Šå‰ç¼€

domain=blog.hk416.space

Please input the directory for the domain:blog.hk416.space :
(Default directory: /data/wwwroot/blog.hk416.space): 
#è¯·è¾“å…¥ç½‘ç«™æ•°æ®çš„æ ¹ç›®å½•ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥å›è½¦å°±å¥½äº†
Virtual Host Directory=/data/wwwroot/blog.hk416.space

Create Virtul Host directory......
set permissions of Virtual Host directory......

Do you want to add more domain name? [y/n]: n
#ä½ æƒ³è¦ä¸ºè¿™ä¸ªç½‘ç«™æ·»åŠ æ›´å¤šåŸŸåå—ï¼Ÿ

Do you want to redirect all HTTP requests to HTTPS? [y/n]: y
#ä½ æƒ³è®©ä½ çš„ç½‘ç«™å¼ºåˆ¶httpsğŸï¼Ÿ

#å¡«å†™å®Œè¿™é‡Œä¹‹åï¼Œè„šæœ¬å°±ä¼šè‡ªåŠ¨å¸®ä½ ç”³è¯·SSLè¯ä¹¦ï¼Œå¦‚æœæˆ‘ä»¬ä¸€å¼€å§‹æ²¡æœ‰è§£æçš„è¯ï¼Œè¿™é‡Œå°±ä¼šå¤±è´¥å™¢
.....
[Mon Sep  7 17:45:22 CST 2020] Your cert is in  /root/.acme.sh/blog.hk416.space/blog.hk416.space.cer 
[Mon Sep  7 17:45:22 CST 2020] Your cert key is in  /root/.acme.sh/blog.hk416.space/blog.hk416.space.key 
[Mon Sep  7 17:45:22 CST 2020] The intermediate CA cert is in  /root/.acme.sh/blog.hk416.space/ca.cer 
[Mon Sep  7 17:45:22 CST 2020] And the full chain certs is there:  /root/.acme.sh/blog.hk416.space/fullchain.cer 
nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful
#ç”³è¯·å®Œæˆ

Do you want to add hotlink protection? [y/n]:y 
#ä½ éœ€è¦çƒ­é“¾ä¿æŠ¤å—ï¼Ÿè¿™ä¸ªåœ°æ–¹éšæ„å§ï¼Œä¸è¿‡å¤šä¸€ä¸ªé˜²æŠ¤æ€»ä¸æ˜¯åäº‹

Allow Rewrite rule? [y/n]: y
#å…è®¸ç½‘å€é‡å†™å—ï¼Ÿè¿™é‡Œä¸ºäº†ä»¥åæˆ‘ä»¬çš„åšå®¢ç½‘å€èƒ½æ¯”è¾ƒè‡ªç”±ç¾è§‚ï¼Œå¯ä»¥å¼€ä¸€ä¸‹ã€‚ä½†æ˜¯ä¸å¼€ä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚
wordpress,opencart,magento2,drupal,joomla,codeigniter,laravel
thinkphp,pathinfo,discuz,typecho,ecshop,nextcloud,zblog,whmcs rewrite was exist.
(Default rewrite: other): typecho
#é€‰æ‹©yåä¼šç»™ä½ ä¸€äº›è‡ªå¸¦çš„é€‰é¡¹ã€‚è¿™é‡Œå¯¹æˆ‘ä»¬æ¯”è¾ƒæœ‰ç”¨çš„æ— éwordpress,zblog,typechoäº†ï¼Œçœ‹è‡ªå·±è¦é€‰æ‹©ä»€ä¹ˆåšå®¢ç¨‹åºæ¥å¡«å†™å§ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©typecho

Allow Nginx/Tengine/OpenResty access_log? [y/n]: y
#æœ€åä¸€ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦ç½‘ç«™çš„è®¿é—®è®°å½•å—ï¼Ÿå½“ç„¶éœ€è¦
You access log file=/data/wwwlogs/blog.hk416.space_nginx.log

nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful
Reload Nginx......

#######################################################################
#       OneinStack for CentOS/RedHat 6+ Debian 8+ and Ubuntu 14+      #
#       For more information please visit https://oneinstack.com      #
#######################################################################
Your domain:                  blog.hk416.space
Virtualhost conf:             /usr/local/nginx/conf/vhost/blog.hk416.space.conf
Directory of:                 /data/wwwroot/blog.hk416.space
Rewrite rule:                 /usr/local/nginx/conf/rewrite/typecho.conf
Let's Encrypt SSL Certificate:/usr/local/nginx/conf/ssl/blog.hk416.space.crt
SSL Private Key:              /usr/local/nginx/conf/ssl/blog.hk416.space.key
```

åˆ°è¿™é‡Œï¼Œä½ çš„ç½‘ç«™å°±å»ºç«‹å¥½å•¦ã€‚å»è®¿é—®è¯•è¯•çœ‹å§ã€‚

![å¥½è€¶ï¼](https://cdn.exia.xyz/img/imouto/course7/5.png)

å¯ä»¥è®¿é—®äº†ï¼ä¸è¿‡å› ä¸ºç½‘ç«™çš„æ ¹ç›®å½•è¿˜æ²¡æœ‰æ–‡ä»¶ã€‚æ‰€ä»¥ä¼šæ˜¾ç¤º403é”™è¯¯ï¼Œè¿™ä¸ªä¸æ˜¯å¤§é—®é¢˜ï¼Œç­‰åˆ°æˆ‘ä»¬å®‰è£…åšå®¢ç³»ç»Ÿçš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æ¶ˆå¤±å•¦ã€‚åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿè®©æ‰€æœ‰äººåœ¨æµè§ˆå™¨è¾“å…¥æˆ‘ä»¬çš„åŸŸå(`blog.hk416.space`)å°±èƒ½è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™äº†ã€‚ä½†å¯¹äºä¸€ä¸ªåšå®¢ç³»ç»Ÿæ¥è¯´ï¼Œè¿˜å°‘äº†ä¸€æ ·ä¸œè¥¿â€”â€”æ•°æ®åº“ã€‚æ²¡é”™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ–°å»ºä¸€ä¸ªæ•°æ®åº“ï¼

æ‰“å¼€ä½ çš„æµè§ˆå™¨ï¼Œåœ¨åœ°å€æ è¾“å…¥`http://ä½ çš„IP/phpMyAdmin`ï¼Œè¾“å…¥ç”¨æˆ·åä¸å¯†ç (å®‰è£…Oneinstackæ—¶è®¾ç½®çš„)ã€‚æˆ‘ä»¬ä¼šçœ‹åˆ°è¿™æ ·çš„ç”»é¢ã€‚

![phpMyAdminä¸»ç•Œé¢](https://cdn.exia.xyz/img/imouto/course7/6.png)

èªæ˜çš„ä½ ä¸€å®šå‘ç°äº†ï¼Œå·¦ä¾§çš„ä¾§è¾¹æ æœ‰ä¸€ä¸ªæ–°å»ºé€‰é¡¹ã€‚æ²¡é”™ï¼Œé‚£ç¡®å®æ˜¯ä¸€ä¸ªå¯ä»¥æ–°å»ºæ•°æ®åº“çš„åœ°æ–¹ã€‚ä¸è¿‡å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸Šæ–¹çš„`è´¦æˆ·`ï¼Œæ–°å»ºä¸€ä¸ªå­ç”¨æˆ·ã€‚

![å®‰å…¨ç¬¬ä¸€æ¡](https://cdn.exia.xyz/img/imouto/course7/7.png)

![](https://cdn.exia.xyz/img/imouto/course7/8.png)

åªéœ€è¦å¡«å†™çº¢æ¡†ä¸­çš„å­—æ®µå°±å¯ä»¥äº†ï¼Œè®°å¾—å‹¾ä¸Š`åˆ›å»ºä¸ç”¨æˆ·åŒåçš„æ•°æ®åº“å¹¶æˆäºˆæ‰€æœ‰æƒé™ã€‚ `è¿™ä¸ªé€‰é¡¹ã€‚å®Œæˆè¿™ä¸€æ­¥ä¹‹åå‘¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥é¿å…ç›´æ¥ä½¿ç”¨rootè´¦æˆ·è¿æ¥æ•°æ®åº“è€Œé€ æˆä¸€äº›æ½œåœ¨çš„å®‰å…¨éšæ‚£ï¼Œæ¯•ç«Ÿè¿™ä¸ªè´¦å·åªèƒ½æ“ä½œè¿™ä¸€ä¸ªæ•°æ®åº“ã€‚

åˆ°è¿™é‡Œç½‘ç«™çš„æ·»åŠ å°±å®Œæˆå•¦ï¼æ˜¯ä¸æ˜¯è¿˜ä¸é”™å‘¢ï¼Ÿ



### å®å¡”

å®å¡”å°±ç®€å•çš„å¤šå•¦ï¼Œåœ¨å®å¡”çš„é¦–é¡µï¼Œæˆ‘ä»¬ç‚¹å‡»å·¦ä¾§æ çš„`ç½‘ç«™`ï¼Œç„¶åé€‰æ‹©`æ·»åŠ ç«™ç‚¹`ã€‚

![æ–¹ä¾¿ã®å®å¡”](https://cdn.exia.xyz/img/imouto/course7/9.png)

æŒ‰ç…§æç¤ºæ·»åŠ å°±å¥½äº†

![æ·»åŠ ](https://cdn.exia.xyz/img/imouto/course7/10.png)

æ•°æ®åº“å­—ç¬¦é›†è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©é€‚ç”¨æ€§æ›´åŠ å¹¿çš„`utf8mb4`ï¼Œä»¥æ»¡è¶³æ—¥åæ—¥ç›Šå¢åŠ çš„éœ€æ±‚ã€‚ç‚¹å‡»æäº¤ï¼Œç„¶åæˆ‘ä»¬çš„ç½‘ç«™è¿™é‡Œå°±ä¼šå¤šä¸€æ¡å•¦ã€‚

![](https://cdn.exia.xyz/img/imouto/course7/11.png)

å…¶å®åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»åŸºæœ¬å®Œæˆäº†ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜è¦ç²¾ç›Šæ±‚ç²¾ï¼Œä¸ºæˆ‘ä»¬çš„ç½‘ç«™åŠ ä¸Šä¸ª`https`ã€‚å®å¡”ä¹Ÿæ˜¯ç›¸å½“æ–¹ä¾¿ï¼Œç›´æ¥ç‚¹å‡»é‚£ä¸ªæ©™è‰²çš„`æœªéƒ¨ç½²`æŒ‰é’®ï¼Œé€‰æ‹©`Let's Encrypt`å°±å¯ä»¥è‡ªåŠ¨éƒ¨ç½²äº†ã€‚

![](https://cdn.exia.xyz/img/imouto/course7/12.png)

![æˆåŠŸ](https://cdn.exia.xyz/img/imouto/course7/13.png)

è®°å¾—æŠŠå¼ºåˆ¶httpsç‚¹ä¸Šå™¢ã€‚

![å¤§åŠŸå‘Šæˆ](https://cdn.exia.xyz/img/imouto/course7/14.png)



